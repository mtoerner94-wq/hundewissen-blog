---
// TableOfContents.astro — Automatisches Inhaltsverzeichnis aus H2-Headings

interface Props {
  body: string;
}

const { body } = Astro.props;

// H2-Headings aus dem Markdown-Body extrahieren
const headingRegex = /^## (.+)$/gm;
const headings: { text: string; slug: string }[] = [];

let match;
while ((match = headingRegex.exec(body)) !== null) {
  const text = match[1]
    .replace(/\*\*/g, '')     // Bold-Markdown entfernen
    .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1') // Links zu reinem Text
    .trim();

  // Astro/github-slugger kompatible ID-Generierung
  const slug = text
    .toLowerCase()
    .replace(/ä/g, 'ä').replace(/ö/g, 'ö').replace(/ü/g, 'ü').replace(/ß/g, 'ß')
    .replace(/[^\w\s\u00C0-\u024F-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-')
    .replace(/^-|-$/g, '');

  headings.push({ text, slug });
}
---

{headings.length >= 3 && (
  <nav class="mb-10 bg-[#FFF8F0] rounded-2xl overflow-hidden">
    <details open>
      <summary class="flex items-center gap-2 px-6 py-4 cursor-pointer select-none font-semibold text-slate-900 hover:bg-[#F5E6D3]/50 transition-colors">
        <svg class="w-5 h-5 text-[var(--color-primary)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
        </svg>
        Inhaltsverzeichnis
      </summary>
      <ol class="px-6 pb-5 pt-1 space-y-1.5 list-decimal list-inside">
        {headings.map((heading) => (
          <li class="text-sm">
            <a
              href={`#${heading.slug}`}
              class="text-slate-600 hover:text-[var(--color-primary)] transition-colors"
            >
              {heading.text}
            </a>
          </li>
        ))}
      </ol>
    </details>
  </nav>
)}
