---
const stats = [
  { value: 8, suffix: '+', label: 'Fundierte Artikel' },
  { value: 6, suffix: '', label: 'Themenbereiche' },
  { value: 0, suffix: '%', label: 'Panikmache' },
];
---

<section class="py-24 px-4">
  <div class="max-w-4xl mx-auto">
    <h2 class="scroll-fade-in text-3xl md:text-4xl font-bold text-slate-900 text-center mb-16">
      Hundewissen in Zahlen
    </h2>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-8">
      {stats.map((stat, i) => (
        <div class={`scroll-fade-in stagger-${i + 1} text-center`}>
          <div class="text-5xl font-bold text-primary mb-2">
            <span
              class="stat-counter"
              data-target={stat.value}
              data-suffix={stat.suffix}
            >
              0{stat.suffix}
            </span>
          </div>
          <div class="text-sm text-slate-500 font-medium">
            {stat.label}
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  function initStatsCounter() {
    const counters = document.querySelectorAll('.stat-counter');
    if (counters.length === 0) return;

    const animateCounter = (el: Element) => {
      const target = parseInt(el.getAttribute('data-target') || '0');
      const suffix = el.getAttribute('data-suffix') || '';
      const duration = 1500;
      const start = performance.now();

      const step = (now: number) => {
        const elapsed = now - start;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        const current = Math.round(eased * target);
        el.textContent = current + suffix;

        if (progress < 1) {
          requestAnimationFrame(step);
        }
      };

      requestAnimationFrame(step);
    };

    const counterObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            animateCounter(entry.target);
            counterObserver.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.5 }
    );

    counters.forEach((counter) => counterObserver.observe(counter));
  }

  document.addEventListener('astro:page-load', initStatsCounter);
</script>
