---
const navItems = [
  { label: 'Hundeernährung', href: '/hundeernaehrung/' },
  { label: 'Hundegesundheit', href: '/hundegesundheit/' },
  { label: 'Erziehung & Verhalten', href: '/erziehung-verhalten/' },
  { label: 'Hundeausstattung', href: '/hundeausstattung/' },
  { label: 'Hunderassen', href: '/hunderassen/' },
  { label: 'Hundepflege', href: '/hundepflege/' },
];

const currentPath = Astro.url.pathname;
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 z-50 glass transition-shadow duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 md:h-18">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-1 group shrink-0">
        <img src="/images/logo-chibi.webp" alt="Hundewissen mit Kopf Logo" class="w-8 h-8 md:w-10 md:h-10" width="40" height="40" />
        <span class="text-xl md:text-2xl font-bold text-primary-dark tracking-tight">
          Hundewissen
        </span>
        <span class="text-xl md:text-2xl font-semibold text-slate-500">
          mit Kopf
        </span>
        <span class="text-primary text-2xl md:text-3xl leading-none font-bold -ml-0.5">.</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-1" aria-label="Hauptnavigation">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200',
              currentPath.startsWith(item.href)
                ? 'text-primary-text bg-primary/10'
                : 'text-slate-600 hover:text-primary-text hover:bg-primary/5',
            ]}
          >
            {item.label}
          </a>
        ))}
      </nav>

      <!-- Search Button (Desktop) -->
      <button
        id="search-trigger-desktop"
        class="hidden lg:flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm text-slate-500 hover:text-primary-text hover:bg-primary/5 transition-colors border border-slate-200 hover:border-primary/30 cursor-pointer"
        aria-label="Suche öffnen"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <span class="text-xs text-slate-400">Suche</span>
        <kbd class="hidden sm:inline-flex items-center px-1.5 py-0.5 text-[10px] font-mono text-slate-400 bg-slate-100 rounded ml-1">⌘K</kbd>
      </button>

      <!-- Right side: Search (mobile) + Hamburger -->
      <div class="flex items-center gap-1 lg:hidden">
        <!-- Search Button (Mobile, in header bar) -->
        <button
          id="search-trigger-mobile-bar"
          class="flex items-center justify-center w-10 h-10 rounded-lg text-slate-600 hover:text-primary-text hover:bg-slate-100 transition-colors cursor-pointer"
          aria-label="Suche öffnen"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </button>

        <!-- Mobile Hamburger Button -->
        <button
          id="menu-toggle"
          class="relative z-10 flex flex-col justify-center items-center w-10 h-10 rounded-lg hover:bg-slate-100 transition-colors"
          aria-label="Menü öffnen"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <span id="hamburger-top" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out"></span>
          <span id="hamburger-mid" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out mt-1.5"></span>
          <span id="hamburger-bot" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out mt-1.5"></span>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Mobile Fullscreen Overlay Menu (outside header to avoid stacking context issues) -->
<div
  id="mobile-menu"
  class="fixed inset-0 z-[60] bg-white flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"
  inert
>
  <!-- Close button top-right -->
  <button
    id="menu-close"
    class="absolute top-4 right-4 w-10 h-10 flex items-center justify-center rounded-lg hover:bg-slate-100 transition-colors"
    aria-label="Menü schließen"
  >
    <svg class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>

  <!-- Logo in overlay -->
  <div class="absolute top-4 left-4 flex items-center gap-1">
    <img src="/images/logo-chibi.webp" alt="Hundewissen mit Kopf Logo" class="w-8 h-8" width="32" height="32" />
    <span class="text-xl font-bold text-primary-dark tracking-tight">Hundewissen</span>
    <span class="text-xl font-semibold text-slate-500">mit Kopf</span>
    <span class="text-primary text-2xl leading-none font-bold -ml-0.5">.</span>
  </div>

  <!-- Search Button (Mobile, in overlay) -->
  <button
    id="search-trigger-mobile"
    class="flex items-center gap-2 text-lg font-medium px-8 py-3 rounded-xl text-slate-700 hover:text-[var(--color-primary)] hover:bg-[var(--color-primary)]/5 transition-colors mb-2 cursor-pointer"
    aria-label="Suche öffnen"
  >
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
    Suche
  </button>

  <nav class="flex flex-col items-center gap-3" aria-label="Mobile Navigation">
    {navItems.map((item) => (
      <a
        href={item.href}
        class:list={[
          'text-xl font-medium px-8 py-3 rounded-xl transition-colors duration-200',
          currentPath.startsWith(item.href)
            ? 'text-primary-text bg-primary/10'
            : 'text-slate-700 hover:text-primary-text hover:bg-primary/5',
        ]}
      >
        {item.label}
      </a>
    ))}
  </nav>
</div>

<!-- Spacer to offset fixed header -->
<div class="h-16 md:h-18"></div>

<script>
  // Scroll-Shadow: Einmal registrieren, dynamisch das aktuelle Header-Element abfragen
  window.addEventListener('scroll', () => {
    const header = document.getElementById('site-header');
    if (header) {
      if (window.scrollY > 10) {
        header.classList.add('shadow-md');
      } else {
        header.classList.remove('shadow-md');
      }
    }
  }, { passive: true });

  // Menü-Reset bei Navigation (falls Menü während Navigation offen war)
  document.addEventListener('astro:after-swap', () => {
    document.body.style.overflow = '';
  });

  // Per-Navigation Setup: Menü-Toggle, Search-Triggers, Event-Listener
  document.addEventListener('astro:page-load', () => {
    const toggle = document.getElementById('menu-toggle');
    const closeBtn = document.getElementById('menu-close');
    const menu = document.getElementById('mobile-menu');
    let isOpen = false;

    if (!toggle || !menu) return;

    function openMenu() {
      isOpen = true;
      menu!.classList.remove('opacity-0', 'pointer-events-none');
      menu!.classList.add('opacity-100', 'pointer-events-auto');
      menu!.removeAttribute('inert');
      toggle!.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      isOpen = false;
      menu!.classList.add('opacity-0', 'pointer-events-none');
      menu!.classList.remove('opacity-100', 'pointer-events-auto');
      menu!.setAttribute('inert', '');
      toggle!.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
    }

    toggle.addEventListener('click', () => {
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    if (closeBtn) {
      closeBtn.addEventListener('click', closeMenu);
    }

    menu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });

    // Search triggers
    ['search-trigger-desktop', 'search-trigger-mobile', 'search-trigger-mobile-bar'].forEach(id => {
      const btn = document.getElementById(id);
      btn?.addEventListener('click', () => {
        if (isOpen) closeMenu();
        (window as any).__openSearch?.();
      });
    });
  });
</script>
