---
const navItems = [
  { label: 'Hundeernährung', href: '/hundeernaehrung/' },
  { label: 'Hundegesundheit', href: '/hundegesundheit/' },
  { label: 'Erziehung & Verhalten', href: '/erziehung-verhalten/' },
  { label: 'Hundeausstattung', href: '/hundeausstattung/' },
  { label: 'Hunderassen', href: '/hunderassen/' },
  { label: 'Hundepflege', href: '/hundepflege/' },
];

const currentPath = Astro.url.pathname;
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 z-50 glass transition-shadow duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 md:h-18">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-1 group shrink-0">
        <span class="text-xl md:text-2xl font-bold text-primary-dark tracking-tight">
          Hundewissen
        </span>
        <span class="text-xl md:text-2xl font-semibold text-slate-500">
          mit Kopf
        </span>
        <span class="text-primary text-2xl md:text-3xl leading-none font-bold -ml-0.5">.</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-1" aria-label="Hauptnavigation">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200',
              currentPath.startsWith(item.href)
                ? 'text-primary bg-primary/10'
                : 'text-slate-600 hover:text-primary hover:bg-primary/5',
            ]}
          >
            {item.label}
          </a>
        ))}
      </nav>

      <!-- Mobile Hamburger Button -->
      <button
        id="menu-toggle"
        class="lg:hidden relative z-10 flex flex-col justify-center items-center w-10 h-10 rounded-lg hover:bg-slate-100 transition-colors"
        aria-label="Menü öffnen"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span id="hamburger-top" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out"></span>
        <span id="hamburger-mid" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out mt-1.5"></span>
        <span id="hamburger-bot" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out mt-1.5"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Fullscreen Overlay Menu -->
  <div
    id="mobile-menu"
    class="fixed inset-0 z-50 bg-white/95 backdrop-blur-xl flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"
    aria-hidden="true"
  >
    <nav class="flex flex-col items-center gap-2" aria-label="Mobile Navigation">
      {navItems.map((item) => (
        <a
          href={item.href}
          class:list={[
            'text-lg font-medium px-6 py-3 rounded-xl transition-colors duration-200',
            currentPath.startsWith(item.href)
              ? 'text-primary bg-primary/10'
              : 'text-slate-700 hover:text-primary hover:bg-primary/5',
          ]}
        >
          {item.label}
        </a>
      ))}
    </nav>
  </div>
</header>

<!-- Spacer to offset fixed header -->
<div class="h-16 md:h-18"></div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('menu-toggle');
    const menu = document.getElementById('mobile-menu');
    const header = document.getElementById('site-header');
    const topBar = document.getElementById('hamburger-top');
    const midBar = document.getElementById('hamburger-mid');
    const botBar = document.getElementById('hamburger-bot');
    let isOpen = false;

    if (!toggle || !menu) return;

    function openMenu() {
      isOpen = true;
      menu.classList.remove('opacity-0', 'pointer-events-none');
      menu.classList.add('opacity-100', 'pointer-events-auto');
      menu.setAttribute('aria-hidden', 'false');
      toggle.setAttribute('aria-expanded', 'true');
      toggle.setAttribute('aria-label', 'Menü schließen');
      document.body.style.overflow = 'hidden';

      // Animate hamburger to X
      if (topBar && midBar && botBar) {
        topBar.style.transform = 'translateY(8px) rotate(45deg)';
        midBar.style.opacity = '0';
        botBar.style.transform = 'translateY(-8px) rotate(-45deg)';
      }
    }

    function closeMenu() {
      isOpen = false;
      menu.classList.add('opacity-0', 'pointer-events-none');
      menu.classList.remove('opacity-100', 'pointer-events-auto');
      menu.setAttribute('aria-hidden', 'true');
      toggle.setAttribute('aria-expanded', 'false');
      toggle.setAttribute('aria-label', 'Menü öffnen');
      document.body.style.overflow = '';

      // Reset hamburger
      if (topBar && midBar && botBar) {
        topBar.style.transform = '';
        midBar.style.opacity = '1';
        botBar.style.transform = '';
      }
    }

    toggle.addEventListener('click', () => {
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Close menu on link click
    menu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        closeMenu();
      }
    });

    // Add shadow on scroll
    let lastScrollY = 0;
    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY;
      if (header) {
        if (scrollY > 10) {
          header.classList.add('shadow-md');
        } else {
          header.classList.remove('shadow-md');
        }
      }
      lastScrollY = scrollY;
    }, { passive: true });
  });
</script>
