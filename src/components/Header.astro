---
const navItems = [
  { label: 'Hundeernährung', href: '/hundeernaehrung/' },
  { label: 'Hundegesundheit', href: '/hundegesundheit/' },
  { label: 'Erziehung & Verhalten', href: '/erziehung-verhalten/' },
  { label: 'Hundeausstattung', href: '/hundeausstattung/' },
  { label: 'Hunderassen', href: '/hunderassen/' },
  { label: 'Hundepflege', href: '/hundepflege/' },
];

const currentPath = Astro.url.pathname;
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 z-50 glass transition-shadow duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 md:h-18">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-1 group shrink-0">
        <span class="text-xl md:text-2xl font-bold text-primary-dark tracking-tight">
          Hundewissen
        </span>
        <span class="text-xl md:text-2xl font-semibold text-slate-500">
          mit Kopf
        </span>
        <span class="text-primary text-2xl md:text-3xl leading-none font-bold -ml-0.5">.</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-1" aria-label="Hauptnavigation">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200',
              currentPath.startsWith(item.href)
                ? 'text-primary bg-primary/10'
                : 'text-slate-600 hover:text-primary hover:bg-primary/5',
            ]}
          >
            {item.label}
          </a>
        ))}
      </nav>

      <!-- Mobile Hamburger Button -->
      <button
        id="menu-toggle"
        class="lg:hidden relative z-10 flex flex-col justify-center items-center w-10 h-10 rounded-lg hover:bg-slate-100 transition-colors"
        aria-label="Menü öffnen"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span id="hamburger-top" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out"></span>
        <span id="hamburger-mid" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out mt-1.5"></span>
        <span id="hamburger-bot" class="block w-5 h-0.5 bg-slate-700 transition-all duration-300 ease-in-out mt-1.5"></span>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Fullscreen Overlay Menu (outside header to avoid stacking context issues) -->
<div
  id="mobile-menu"
  class="fixed inset-0 z-[60] bg-white flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"
  aria-hidden="true"
>
  <!-- Close button top-right -->
  <button
    id="menu-close"
    class="absolute top-4 right-4 w-10 h-10 flex items-center justify-center rounded-lg hover:bg-slate-100 transition-colors"
    aria-label="Menü schließen"
  >
    <svg class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>

  <!-- Logo in overlay -->
  <div class="absolute top-4 left-4 flex items-center gap-1">
    <span class="text-xl font-bold text-primary-dark tracking-tight">Hundewissen</span>
    <span class="text-xl font-semibold text-slate-500">mit Kopf</span>
    <span class="text-primary text-2xl leading-none font-bold -ml-0.5">.</span>
  </div>

  <nav class="flex flex-col items-center gap-3" aria-label="Mobile Navigation">
    {navItems.map((item) => (
      <a
        href={item.href}
        class:list={[
          'text-xl font-medium px-8 py-3 rounded-xl transition-colors duration-200',
          currentPath.startsWith(item.href)
            ? 'text-primary bg-primary/10'
            : 'text-slate-700 hover:text-primary hover:bg-primary/5',
        ]}
      >
        {item.label}
      </a>
    ))}
  </nav>
</div>

<!-- Spacer to offset fixed header -->
<div class="h-16 md:h-18"></div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('menu-toggle');
    const closeBtn = document.getElementById('menu-close');
    const menu = document.getElementById('mobile-menu');
    const header = document.getElementById('site-header');
    let isOpen = false;

    if (!toggle || !menu) return;

    function openMenu() {
      isOpen = true;
      menu.classList.remove('opacity-0', 'pointer-events-none');
      menu.classList.add('opacity-100', 'pointer-events-auto');
      menu.setAttribute('aria-hidden', 'false');
      toggle.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      isOpen = false;
      menu.classList.add('opacity-0', 'pointer-events-none');
      menu.classList.remove('opacity-100', 'pointer-events-auto');
      menu.setAttribute('aria-hidden', 'true');
      toggle.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
    }

    // Open on hamburger click
    toggle.addEventListener('click', () => {
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Close on X button click
    if (closeBtn) {
      closeBtn.addEventListener('click', closeMenu);
    }

    // Close menu on link click
    menu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        closeMenu();
      }
    });

    // Add shadow on scroll
    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY;
      if (header) {
        if (scrollY > 10) {
          header.classList.add('shadow-md');
        } else {
          header.classList.remove('shadow-md');
        }
      }
    }, { passive: true });
  });
</script>
