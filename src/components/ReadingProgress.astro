---
// ReadingProgress.astro — Dünner Lesefortschritts-Balken am oberen Bildschirmrand
---

<div
  id="reading-progress"
  class="fixed top-0 left-0 h-[3px] bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-primary-dark)] z-[60] transition-[width] duration-150 ease-out"
  style="width: 0%"
  aria-hidden="true"
></div>

<script>
  let cleanupReadingProgress: (() => void) | null = null;

  function initReadingProgress() {
    if (cleanupReadingProgress) {
      cleanupReadingProgress();
      cleanupReadingProgress = null;
    }

    const bar = document.getElementById('reading-progress');
    if (!bar) return;

    bar.style.width = '0%';

    const update = () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const progress = docHeight > 0 ? Math.min((scrollTop / docHeight) * 100, 100) : 0;
      bar.style.width = `${progress}%`;
    };

    let ticking = false;
    const onScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          update();
          ticking = false;
        });
        ticking = true;
      }
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    update();

    cleanupReadingProgress = () => {
      window.removeEventListener('scroll', onScroll);
    };
  }

  document.addEventListener('astro:page-load', initReadingProgress);
</script>
